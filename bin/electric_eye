#!/usr/bin/env ruby

require 'optparse'
require 'methadone'
require 'construct'
require 'electric_eye.rb'
include ElectricEye

class App
  include Methadone::Main
  include Methadone::CLILogging

  main do |camera, url| # Add args you want: |like,so|
    @config = ConfigEye.load    # Load settings
    
    if options[:a]              # Add camera
      ConfigEye.add_camera(camera,url) 
    elsif options[:r]           # Remove camera
      ConfigEye.remove_camera(camera)            
    end
    
    exit 0
  end
  
  description "Network Video Recorder"

  # Accept flags via:
  on("-a", "--add", "Add a camera") 
  on("-r", "--remove", "Remove a camera") 

  # Arguments
  arg :camera, :optional
  arg :url, :optional

  version ElectricEye::VERSION
  use_log_level_option :toggle_debug_on_signal => 'USR1'

  go!
end
